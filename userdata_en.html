<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Data - SFT21 InFace Invest Group</title>

    <!-- ============================================= -->
    <!-- UNIVERSAL THEME INITIALIZATION SCRIPT -->
    <!-- Solves the "flash" and back-forward cache issue -->
    <!-- ============================================= -->
    <script>
        function applySft21Theme() {
            try {
                const theme = localStorage.getItem('sft21_theme') || 'dark';
                if (theme === 'light') {
                    document.documentElement.classList.add('light-mode');
                } else {
                    document.documentElement.classList.remove('light-mode');
                }
            } catch (e) {
                console.error('Error applying theme:', e);
            }
        }
        applySft21Theme();
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                console.log('Page loaded from bfcache, re-checking theme.');
                applySft21Theme();
            }
        });
    </script>

    <!-- CSS Links -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- Styles for this page -->
    <style>
        body, h1, h2, h3, h4, h5, h6, p, span, div, button, input, select, textarea {
            font-family: 'Arial Narrow', Arial, sans-serif !important;
        }
        body {
            padding-top: 1rem;
            padding-bottom: 0;
            overflow-y: hidden;
            background-color: #0d0118;
            color: var(--text-color);
            overflow-x: hidden;
        }
        #network-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        .input-container { position: relative; margin-bottom: 2rem; }
        .input-title { font-size: 2.5rem; font-weight: bold; color: var(--fluorescent-green); text-align: center; margin-bottom: 2rem; }
        .input-field { width: 100%; padding: 15px; background-color: rgba(106, 27, 154, 0.1); border: 1px solid var(--fluorescent-green); border-radius: 8px; color: white; font-size: 1.2rem; transition: all 0.3s ease; }
        .input-field:focus { outline: none; border-color: var(--fluorescent-green); box-shadow: 0 0 0 3px rgba(128, 255, 0, 0.3); background-color: rgba(106, 27, 154, 0.2); }
        .input-field::placeholder { color: rgba(255, 255, 255, 0.4); }
        .input-requirements { display: flex; flex-direction: column; align-items: flex-start; margin-top: 1.5rem; gap: 0.5rem; padding: 0 1rem; }
        .requirement { color: var(--fluorescent-green); font-size: 1rem; padding: 0.25rem 0; text-align: left; }
        .save-button { background-color: var(--fluorescent-green); color: #0e076a; padding: 12px 24px; border-radius: 50px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; transition: all 0.3s ease; border: none; margin-top: 1rem; display: none; position: absolute; right: 0; bottom: -60px; }
        .save-button:hover { background-color: #66cc00; transform: translateY(-3px); box-shadow: 0 10px 20px rgba(128, 255, 0, 0.4); }
        .toggle-password { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--fluorescent-green); font-size: 1.2rem; }
        .fade-in-section { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
        .fade-in-section.active { opacity: 1; transform: translateY(0); }
        .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #0d0118; border: 1px solid var(--fluorescent-green); border-radius: 20px; padding: 2rem; z-index: 1000; box-shadow: 0 8px 32px 0 rgba(128, 255, 0, 0.37); max-width: 400px; width: 90%; display: none; }
        .popup-content { text-align: center; color: var(--text-color); display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .popup-title { color: var(--fluorescent-green) !important; font-size: 1.5rem; margin-bottom: 1rem; }
        .popup-message { margin-bottom: 1.5rem; font-size: 1.1rem; line-height: 1.5; }
        .popup-button { color: #0e076a !important; background-color: var(--fluorescent-green) !important; padding: 10px 20px; border-radius: 50px; font-weight: 600; border: none; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; margin-top: 1rem; }
        .popup-button:hover { background-color: #66cc00 !important; box-shadow: 0 5px 15px rgba(128, 255, 0, 0.4); }
        .popup-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); z-index: 999; display: none; }
        .warning-note { color: white; font-size: 1.2rem; font-style: italic; margin-top: 1.5rem; text-align: center; }
        @media (max-width: 768px) { body { padding-top: 1rem; } .input-title { font-size: 1.8rem; } .requirement { font-size: 0.9rem; } .save-button { position: static; width: 100%; margin-top: 2rem; } .input-container { margin-bottom: 1rem; } .glass-card { padding: 1.5rem !important; } .glass-card + .glass-card { margin-top: 1.5rem !important; } .popup { padding: 1.5rem; } .popup-message { font-size: 1rem; } }
        @media (min-width: 769px) { .save-button { position: absolute; bottom: -60px; right: 0; width: auto; margin-top: 1rem; } }
    </style>
    <style>
        html.light-mode body { background-color: #f8fafc !important; color: #334155 !important; }
        html.light-mode #network-canvas { background-color: transparent !important; }
        html.light-mode .glass-card { background-color: #ffffff !important; border-color: #e2e8f0 !important; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05) !important; }
        html.light-mode .input-title { color: var(--primary-color) !important; }
        html.light-mode .input-field { background-color: #f1f5f9 !important; border-color: #cbd5e1 !important; color: #1e293b !important; }
        html.light-mode .input-field::placeholder { color: #94a3b8 !important; }
        html.light-mode .input-field:focus { border-color: var(--primary-color) !important; box-shadow: 0 0 0 3px rgba(106, 27, 154, 0.2) !important; background-color: #ffffff !important; }
        html.light-mode .requirement { color: #475569 !important; }
        html.light-mode .toggle-password { color: var(--primary-color) !important; }
        html.light-mode .warning-note { color: var(--primary-color) !important; }
        html.light-mode .save-button { background-color: var(--primary-color) !important; color: white !important; }
        html.light-mode .save-button:hover { background-color: var(--secondary-color) !important; }
        html.light-mode .popup { background-color: #ffffff !important; border-color: var(--primary-color) !important; }
        html.light-mode .popup-title { color: var(--primary-color) !important; }
        html.light-mode .popup-message { color: #334155 !important; }
        html.light-mode .popup-button { background-color: var(--primary-color) !important; color: white !important; }
        html.light-mode .popup-button:hover { background-color: var(--secondary-color) !important; }
    </style>
</head>

<body class="bg-gray-900">
    <canvas id="network-canvas"></canvas>
    <div class="custom-cursor"></div>
    <div id="popup-overlay" class="popup-overlay"></div>

    <div id="error-popup" class="popup">
        <div class="popup-content">
            <h3 class="popup-title">Error</h3>
            <p id="error-message" class="popup-message">Error message</p>
            <button id="error-close" class="popup-button">OK</button>
        </div>
    </div>

    <div class="container mx-auto px-4">
        <div class="max-w-3xl mx-auto">
            <!-- Username Section -->
            <div id="username-section" class="glass-card p-8 fade-in-section active">
                <h2 class="input-title">Choose a Username</h2>
                <div class="input-container">
                    <input type="text" id="username-input" class="input-field" placeholder="Enter username" autocomplete="off" maxlength="21">
                    <button id="username-save" class="save-button">SAVE</button>
                </div>
                <div class="input-requirements">
                    <div class="requirement">Username must be between 4 and 21 characters long</div>
                    <div class="requirement">- lowercase letter: a - z</div>
                    <div class="requirement">- uppercase letter: A - Z</div>
                    <div class="requirement">- number: 0 - 9</div>
                </div>
                <div class="warning-note text-3g text-white" id="username-warning" style="display: none;">
                    *NOTE: Once you click "SAVE", the chosen username cannot be changed!
                </div>
            </div>

            <!-- Password Section (initially hidden) -->
            <div id="password-section" class="glass-card p-8 fade-in-section" style="display: none;">
                <h2 class="input-title">Choose a Password</h2>
                <div class="input-container">
                    <input type="password" id="password-input" class="input-field" placeholder="Enter password" autocomplete="off" maxlength="21">
                    <span class="toggle-password">
                        <i class="far fa-eye"></i>
                    </span>
                    <button id="password-save" class="save-button">SAVE</button>
                </div>
                <div class="input-requirements">
                    <div class="requirement">Password must be between 7 and 21 characters long</div>
                    <div class="requirement">- lowercase letter: a - z</div>
                    <div class="requirement">- uppercase letter: A - Z</div>
                    <div class="requirement">- number: 0 - 9</div>
                    <div class="requirement">- special character: ! " # $ % & / _ + ~ = ?</div>
                 </div>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const existingUsernames = [ 'admin', 'administrator', 'user', 'test', 'demo', 'moderator', 'support', 'korisnik', 'gost', 'sfteam', 'sfadmin', 'sfuser', 'sft21', 'inface' ];
            const usernameInput = document.getElementById('username-input');
            const usernameSave = document.getElementById('username-save');
            const usernameSection = document.getElementById('username-section');
            const passwordSection = document.getElementById('password-section');
            const passwordInput = document.getElementById('password-input');
            const passwordSave = document.getElementById('password-save');
            const togglePassword = document.querySelector('.toggle-password');
            const errorPopup = document.getElementById('error-popup');
            const errorMessage = document.getElementById('error-message');
            const errorClose = document.getElementById('error-close');
            const popupOverlay = document.getElementById('popup-overlay');

            function showError(message) {
                errorMessage.textContent = message;
                errorPopup.style.display = 'block';
                popupOverlay.style.display = 'block';
            }

            if (errorClose && errorPopup && popupOverlay) {
                 errorClose.addEventListener('click', function() {
                     errorPopup.style.display = 'none';
                     popupOverlay.style.display = 'none';
                 });
                 popupOverlay.addEventListener('click', function() {
                     if (errorPopup.style.display === 'block') {
                         errorPopup.style.display = 'none';
                         popupOverlay.style.display = 'none';
                     }
                 });
            }

            function hasLowerCase(str) { return /[a-z]/.test(str); }
            function hasUpperCase(str) { return /[A-Z]/.test(str); }
            function hasNumber(str) { return /[0-9]/.test(str); }
            function hasSpecialChar(str) { return /[!\"#$%&\/_+~=?]/.test(str); }
            function containsNoSpaces(str) { return !/\s/.test(str); }

            function isPasswordValid(password) {
                return containsNoSpaces(password) &&
                       password.length >= 7 &&
                       password.length <= 21 &&
                       hasLowerCase(password) &&
                       hasUpperCase(password) &&
                       hasNumber(password) &&
                       hasSpecialChar(password);
            }

            if (usernameInput && usernameSave && document.getElementById('username-warning')) {
                 usernameInput.addEventListener('input', function() {
                     let value = this.value;
                     const cleanedValue = value.replace(/[^a-zA-Z0-9]/g, '');
                     if (value !== cleanedValue) {
                          this.value = cleanedValue;
                          showError('Invalid character in username (only letters and numbers are allowed).');
                     }
                     value = this.value;

                     if (value.length > 21) {
                         this.value = value.slice(0, 21);
                         showError('You have entered the maximum allowed number of characters – 21');
                     }
                     value = this.value;

                     if (value.length >= 4 && value.length <= 21 && value === cleanedValue) {
                         usernameSave.style.display = 'block';
                         document.getElementById('username-warning').style.display = 'block';
                     } else {
                         usernameSave.style.display = 'none';
                         if (value.length === 0) {
                              document.getElementById('username-warning').style.display = 'none';
                         }
                     }
                 });
            }

            if (usernameSave && usernameInput && usernameSection && passwordSection) {
                 usernameSave.addEventListener('click', function() {
                     const value = usernameInput.value.trim().toLowerCase();
                     const cleanedValue = value.replace(/[^a-zA-Z0-9]/g, '');
                     if (cleanedValue.length < 4 || cleanedValue.length > 21 || value !== cleanedValue) {
                         showError('Please correct the username according to the requirements (4-21 characters, only letters and numbers).');
                         usernameInput.value = cleanedValue;
                         return;
                     }

                     if (existingUsernames.includes(value)) {
                         showError('This username already exists. Please choose another one.');
                         return;
                     }

                     const requirementsDiv = document.querySelector('#username-section .input-requirements');
                     const usernameWarning = document.getElementById('username-warning');
                     if(requirementsDiv) requirementsDiv.style.display = 'none';
                     if(usernameWarning) usernameWarning.style.display = 'none';
                     usernameSave.style.display = 'none';
                     usernameInput.disabled = true;

                     usernameSection.classList.remove('active');
                      setTimeout(() => {
                          usernameSection.style.display = 'none';
                          passwordSection.style.display = 'block';
                          setTimeout(() => {
                              passwordSection.classList.add('active');
                              if (passwordInput) passwordInput.focus();
                          }, 10);
                     }, 800);
                 });
            }

            if (passwordInput && passwordSave) {
                 passwordInput.addEventListener('input', function() {
                     let value = this.value;
                     if (value.length > 0 && value.startsWith(' ')) {
                         this.value = value.trimStart();
                         value = this.value;
                     }
                     if (value.length >= 7 && value.length <= 21) {
                         passwordSave.style.display = 'block';
                     } else {
                         passwordSave.style.display = 'none';
                     }
                 });
            }

             if (passwordSave && passwordInput && usernameInput) {
                 passwordSave.addEventListener('click', function() {
                     const value = passwordInput.value;
                     const isValid = isPasswordValid(value);

                     if (isValid) {
                         console.log("Password is valid, redirecting...");
                         window.location.href = 'office_kyc_en.html';
                     } else {
                         let specificErrorMessage = 'Password does not meet all requirements.';
                         if (/\s/.test(value)) {
                             specificErrorMessage = 'Password must not contain spaces.';
                         } else if (value.length < 7) {
                             specificErrorMessage = 'Password must be at least 7 characters long.';
                         } else if (value.length > 21) {
                             specificErrorMessage = 'Password must be no more than 21 characters long.';
                         } else if (!hasLowerCase(value)) {
                             specificErrorMessage = 'Password must contain at least one lowercase letter (a-z).';
                         } else if (!hasUpperCase(value)) {
                             specificErrorMessage = 'Password must contain at least one uppercase letter (A-Z).';
                         } else if (!hasNumber(value)) {
                             specificErrorMessage = 'Password must contain at least one number (0-9).';
                         } else if (!hasSpecialChar(value)) {
                             specificErrorMessage = 'Password must contain at least one special character (! " # $ % & / _ + ~ = ?).';
                         }
                         showError(specificErrorMessage);
                     }
                 });
             }
             
            if (usernameInput && usernameSave) {
                 usernameInput.addEventListener('keypress', function(e) {
                     if (e.key === 'Enter' && this.value.trim().length >= 4 && usernameSave.style.display !== 'none') {
                         e.preventDefault();
                         usernameSave.click();
                     }
                 });
            }
             if (passwordInput && passwordSave) {
                 passwordInput.addEventListener('keypress', function(e) {
                     if (e.key === 'Enter' && passwordSave.style.display !== 'none' && !this.value.startsWith(' ')) {
                         e.preventDefault();
                         passwordSave.click();
                     } else if (e.key === 'Enter' && this.value.startsWith(' ')) {
                          e.preventDefault();
                          showError('Password must not start with a space.');
                          this.value = this.value.trimStart();
                     }
                 });
            }

            if (togglePassword && passwordInput) {
                 togglePassword.addEventListener('click', function() {
                     const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                     passwordInput.setAttribute('type', type);
                     const icon = this.querySelector('i');
                     if (icon) {
                         if (type === 'password') {
                             icon.classList.remove('fa-eye-slash');
                             icon.classList.add('fa-eye');
                         } else {
                             icon.classList.remove('fa-eye');
                             icon.classList.add('fa-eye-slash');
                         }
                     }
                 });
            }

            if (usernameSection) {
                 usernameSection.classList.add('active');
            }
        });
    </script>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('network-canvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let particles = [];
        let mouse = { x: null, y: null };
        const darkOptions = { particleColorRGB: '128, 255, 0', lineColorRGB: '170, 0, 255', particleAmount: 120, defaultRadius: 1.3, linkRadius: 150, particleSpeed: 0.25, lineWidth: 0.4, mouseInteractionRadius: 150, mouseEffectStrength: 2 };
        const lightOptions = { particleColorRGB: '106, 27, 154', lineColorRGB: '171, 71, 188', particleAmount: 120, defaultRadius: 1.3, linkRadius: 150, particleSpeed: 0.25, lineWidth: 0.4, mouseInteractionRadius: 150, mouseEffectStrength: 2 };
        let currentOptions = document.documentElement.classList.contains('light-mode') ? lightOptions : darkOptions;
        const resizeCanvas = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; initParticles(); };
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
        window.addEventListener('mouseout', () => { mouse.x = null; mouse.y = null; });
        class Particle { constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.z = Math.random() * 2 - 1; this.radius = currentOptions.defaultRadius * (1 + this.z * 0.5); this.vx = (Math.random() - 0.5) * currentOptions.particleSpeed; this.vy = (Math.random() - 0.5) * currentOptions.particleSpeed; } draw() { let finalRadius = this.radius; let opacity = 1; if (mouse.x !== null) { const dx = this.x - mouse.x; const dy = this.y - mouse.y; const dist = Math.sqrt(dx * dx + dy * dy); if (dist < currentOptions.mouseInteractionRadius) { const effect = (1 - dist / currentOptions.mouseInteractionRadius); finalRadius += effect * currentOptions.mouseEffectStrength; opacity += effect * 0.5; } } ctx.beginPath(); ctx.arc(this.x, this.y, finalRadius, 0, Math.PI * 2); ctx.fillStyle = `rgba(${currentOptions.particleColorRGB}, ${opacity * 0.85})`; ctx.fill(); } update() { this.x += this.vx * (1 + this.z * 0.5); this.y += this.vy * (1 + this.z * 0.5); if (this.x > canvas.width + 5) this.x = -5; else if (this.x < -5) this.x = canvas.width + 5; if (this.y > canvas.height + 5) this.y = -5; else if (this.y < -5) this.y = canvas.height + 5; } }
        const initParticles = () => { particles = []; for (let i = 0; i < currentOptions.particleAmount; i++) { particles.push(new Particle()); } };
        const drawLines = () => { let pulse = Math.sin(Date.now() * 0.001) * 0.2 + 0.8; for (let i = 0; i < particles.length; i++) { for (let j = i + 1; j < particles.length; j++) { const p1 = particles[i]; const p2 = particles[j]; const dist = Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2)); if (dist < currentOptions.linkRadius) { let opacity = 1 - (dist / currentOptions.linkRadius); opacity *= pulse; if (mouse.x !== null) { const distToMouse1 = Math.sqrt(Math.pow(p1.x - mouse.x, 2) + Math.pow(p1.y - mouse.y, 2)); const distToMouse2 = Math.sqrt(Math.pow(p2.x - mouse.x, 2) + Math.pow(p2.y - mouse.y, 2)); if(distToMouse1 < currentOptions.mouseInteractionRadius || distToMouse2 < currentOptions.mouseInteractionRadius) { opacity = Math.min(1, opacity + 0.5); } } ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.strokeStyle = `rgba(${currentOptions.lineColorRGB}, ${opacity * 0.5})`; ctx.lineWidth = currentOptions.lineWidth; ctx.stroke(); } } } };
        const animate = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => p.update()); drawLines(); particles.forEach(p => p.draw()); requestAnimationFrame(animate); };
        window.setAnimationTheme = (theme) => { if (theme === 'light') { currentOptions = lightOptions; } else { currentOptions = darkOptions; } initParticles(); };
        resizeCanvas();
        animate();
    });
    </script>
</body>
</html>